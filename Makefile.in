# Makefile for Taylor UUCP

# Define programs and flags
CC = gcc
CFLAGS = -Wall -Wshadow -Wwrite-strings -g
LIBS =
LN = ln
INSTALL = cp
INSTALL_PROGRAM = $(INSTALL)

# Define destination directories for make install
LIBDIR = /usr/lib/uucp
BINDIR = /usr/bin

# If you don't want to compile tstuu, which requires BSD style ptys
# and the Taylor configuration files, comment out the following line.
# The tstuu program is only used to test the package; it is described
# further in README.
TSTUU = tstuu

# Nothing else to configure

UUOBJS = uucico.o prot.o protg.o protf.o prott.o prote.o config.o v2.o bnu.o \
	file.o util.o sysinf.o prtinf.o time.o log.o chat.o port.o tcp.o \
	parse.o copy.o sys1.o sys2.o sys3.o sys4.o version.o getopt.o
XQTOBJS = uuxqt.o config.o v2.o bnu.o util.o sysinf.o prtinf.o time.o log.o \
	copy.o sys1.o sys3.o sys5.o version.o getopt.o
UUXOBJS = uux.o config.o v2.o bnu.o util.o sysinf.o prtinf.o time.o log.o \
	copy.o sys1.o sys3.o sys6.o version.o getopt.o
UUCPOBJS = uucp.o config.o v2.o bnu.o util.o sysinf.o prtinf.o time.o log.o \
	copy.o sys1.o sys3.o sys6.o version.o getopt.o
UUCHKOBJS = uuchk.o config.o v2.o bnu.o util.o sysinf.o prtinf.o time.o \
	log.o sys1.o version.o getopt.o
TSTOBJS = tstuu.o version.o getopt.o

ALLOBJS = uucico.o uuxqt.o uux.o uucp.o uuchk.o tstuu.o prot.o protg.o \
	protf.o prott.o prote.o config.o v2.o bnu.o file.o util.o sysinf.o \
	prtinf.o time.o log.o chat.o port.o tcp.o parse.o copy.o sys1.o \
	sys2.o sys3.o sys4.o sys5.o sys6.o version.o getopt.o

all: uucico uuxqt uux uucp uuchk $(TSTUU)

install: uucico uuxqt uux uucp uuchk
	-$(LN) $(LIBDIR)/uucico $(LIBDIR)/uucico.old
	-$(LN) $(LIBDIR)/uuxqt $(LIBDIR)/uuxqt.old
	rm -f $(LIBDIR)/uucico $(LIBDIR)/uuxqt
	$(INSTALL_PROGRAM) uucico $(LIBDIR)/uucico
	$(INSTALL_PROGRAM) uuxqt $(LIBDIR)/uuxqt
	$(INSTALL_PROGRAM) uuchk $(LIBDIR)/uuchk
	chown uucp $(LIBDIR)/uucico $(LIBDIR)/uuxqt $(LIBDIR)/uuchk
	chmod 4555 $(LIBDIR)/uucico $(LIBDIR)/uuxqt
	-$(LN) $(BINDIR)/uux $(BINDIR)/uux.old
	-$(LN) $(BINDIR)/uucp $(BINDIR)/uucp.old
	rm -f $(BINDIR)/uux $(BINDIR)/uucp
	$(INSTALL_PROGRAM) uux $(BINDIR)/uux
	$(INSTALL_PROGRAM) uucp $(BINDIR)/uucp
	chown uucp $(BINDIR)/uux $(BINDIR)/uucp
	chmod 4555 $(BINDIR)/uux $(BINDIR)/uucp

uninstall:
	cp $(LIBDIR)/uucico.old $(LIBDIR)/uucico
	cp $(LIBDIR)/uuxqt.old $(LIBDIR)/uuxqt
	cp $(BINDIR)/uux.old $(BINDIR)/uux
	cp $(BINDIR)/uucp.old $(BINDIR)/uucp

uucico: $(UUOBJS)
	$(CC) $(CFLAGS) -o uucico $(UUOBJS) $(LIBS)

uuxqt: $(XQTOBJS)
	$(CC) $(CFLAGS) -o uuxqt $(XQTOBJS) $(LIBS)

uux: $(UUXOBJS)
	$(CC) $(CFLAGS) -o uux $(UUXOBJS) $(LIBS)

uucp: $(UUCPOBJS)
	$(CC) $(CFLAGS) -o uucp $(UUCPOBJS) $(LIBS)

uuchk: $(UUCHKOBJS)
	$(CC) $(CFLAGS) -o uuchk $(UUCHKOBJS) $(LIBS)

tstuu: $(TSTOBJS)
	$(CC) $(CFLAGS) -o tstuu $(TSTOBJS) $(LIBS)

configure-unix:
	$(LN) sysh.unx sysdep.h
	$(LN) sys1.unx sys1.c
	$(LN) sys2.unx sys2.c
	$(LN) sys3.unx sys3.c
	$(LN) sys4.unx sys4.c
	$(LN) sys5.unx sys5.c
	$(LN) sys6.unx sys6.c

clean:
	rm -f $(ALLOBJS) uucico uuxqt uux uucp uuchk tstuu

uucico.o: uucp.h conf.h system.h prot.h port.h sysdep.h getopt.h
uuxqt.o: uucp.h conf.h system.h getopt.h sysdep.h
uux.o: uucp.h conf.h system.h getopt.h sysdep.h
uucp.o: uucp.h conf.h system.h getopt.h sysdep.h
uuchk.o: uucp.h conf.h port.h sysdep.h system.h getopt.h
tstuu.o: uucp.h conf.h sysdep.h getopt.h
prot.o: uucp.h conf.h system.h prot.h port.h sysdep.h
protg.o: uucp.h conf.h system.h prot.h port.h sysdep.h
protf.o: uucp.h conf.h prot.h port.h sysdep.h system.h
prott.o: uucp.h conf.h prot.h port.h sysdep.h system.h
prote.o: uucp.h conf.h prot.h port.h sysdep.h system.h
config.o: uucp.h conf.h system.h sysdep.h
bnu.o: uucp.h conf.h port.h sysdep.h
v2.o: uucp.h conf.h port.h sysdep.h
file.o: uucp.h conf.h system.h
util.o: uucp.h conf.h
sysinf.o: uucp.h conf.h system.h port.h sysdep.h
time.o: uucp.h conf.h
log.o: uucp.h conf.h system.h
chat.o: uucp.h conf.h system.h port.h sysdep.h
port.o: uucp.h conf.h port.h sysdep.h
tcp.o: uucp.h conf.h port.h sysdep.h system.h
prtinf.o: uucp.h conf.h port.h sysdep.h
parse.o: uucp.h conf.h
copy.o: uucp.h conf.h system.h sysdep.h
sys1.o: uucp.h conf.h system.h sysdep.h
sys2.o: uucp.h conf.h system.h port.h sysdep.h
sys3.o: uucp.h conf.h system.h sysdep.h
sys4.o: uucp.h conf.h system.h sysdep.h
sys5.o: uucp.h conf.h system.h sysdep.h
sys6.o: uucp.h conf.h system.h sysdep.h
version.o: uucp.h conf.h
getopt.o: uucp.h conf.h getopt.h
